@model Bloomfiy.Models.Product
@{
    ViewBag.Title = Model.Name + " - Bloomfiy";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var relatedProducts = ViewBag.RelatedProducts as List<Bloomfiy.Models.Product>;
}

<section class="product-detail-hero">
    <div class="container">
        <nav class="breadcrumb">
            <a href="@Url.Action("Index", "Home")">Home</a> &gt;
            <a href="@Url.Action("Catalog", "Product")">Shop</a> &gt;
            <span>@Model.Name</span>
        </nav>
    </div>
</section>

<section class="product-detail">
    <div class="container">
        <div class="product-detail-grid">
            <!-- Product Images -->
            <div class="product-images">
                <div class="main-image">
                    <img src="@Model.MainImageUrl" alt="@Model.Name" id="mainProductImage">
                </div>
                @if (Model.AdditionalImageUrls != null && Model.AdditionalImageUrls.Length > 1)
                {
                    <div class="image-thumbnails">
                        @for (int i = 0; i < Model.AdditionalImageUrls.Length; i++)
                        {
                            <div class="thumbnail @(i == 0 ? "active" : "")" data-image="@Model.AdditionalImageUrls[i]">
                                <img src="@Model.AdditionalImageUrls[i]" alt="@Model.Name - Image @(i+1)">
                            </div>
                        }
                    </div>
                }
            </div>

            <!-- Product Info -->
            <div class="product-info-detail">
                <h1>@Model.Name</h1>

                @if (!string.IsNullOrEmpty(Model.Description))
                {
                    <p class="product-description">@Model.Description</p>
                }

                <!-- Color Selection -->
                @if (Model.ProductColors != null && Model.ProductColors.Any())
                {
                    <div class="color-selection-detail">
                        <label>Select Color:</label>
                        <div class="color-options-detail">
                            @foreach (var pc in Model.ProductColors)
                            {
                                var color = pc.Color;
                                var isFirst = Model.ProductColors.First() == pc;
                                <div class="color-option-detail @(isFirst ? "active" : "")"
                                     data-color-id="@color.ColorId"
                                     data-color-name="@color.ColorName"
                                     data-price="@(Model.BasePrice + color.PriceAdjustment)"
                                     data-image="@Model.MainImageUrl">
                                    <div class="color-swatch-large" style="background-color: @(!string.IsNullOrEmpty(color.ColorCode) ? color.ColorCode : "#ccc")"></div>
                                    <div class="color-info">
                                        <span class="color-name">@color.ColorName</span>
                                        <span class="color-price">$@(Model.BasePrice + color.PriceAdjustment)</span>
                                        @if (color.PriceAdjustment > 0)
                                        {
                                            <span class="color-adjustment">+$@color.PriceAdjustment</span>
                                        }
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                }

                <div class="product-price-detail">
                    <span class="current-price">$@Model.BasePrice</span>
                    @if (Model.BasePrice < 80)
                    {
                        <span class="original-price">$@(Model.BasePrice + 10)</span>
                    }
                </div>

                <div class="product-features-detail">
                    <div class="feature-item">
                        <strong>Category:</strong> @Model.Category?.CategoryName
                    </div>
                    <div class="feature-item">
                        <strong>Stock:</strong> @Model.StockQuantity available
                    </div>
                    <div class="feature-item">
                        <strong>Status:</strong> @(Model.IsAvailable ? "Available" : "Out of Stock")
                    </div>
                    @if (Model.DateCreated > DateTime.Now.AddDays(-30))
                    {
                        <div class="feature-item">
                            <strong>New Arrival!</strong> Added recently
                        </div>
                    }
                </div>

                <!-- Add to Cart -->
                <div class="add-to-cart-detail">
                    <div class="quantity-selector">
                        <button class="quantity-btn minus">-</button>
                        <input type="number" value="1" min="1" max="@Model.StockQuantity" class="quantity-input">
                        <button class="quantity-btn plus">+</button>
                    </div>
                    <button class="add-to-cart-btn large"
                            data-product-id="@Model.ProductId"
                            @(!Model.IsAvailable ? "disabled" : "")>
                        @if (Model.IsAvailable)
                        {
                            <text>Add to Cart - $@Model.BasePrice</text>
                        }
                        else
                        {
                            <text>Out of Stock</text>
                        }
                    </button>
                </div>

                <!-- Quick Features -->
                <div class="quick-features">
                    <div class="feature">
                        <span>🚚</span>
                        <div>
                            <strong>Free Delivery</strong>
                            <p>On orders over $50</p>
                        </div>
                    </div>
                    <div class="feature">
                        <span>💐</span>
                        <div>
                            <strong>Fresh Guarantee</strong>
                            <p>7-day freshness guarantee</p>
                        </div>
                    </div>
                    @if (Model.ProductColors != null && Model.ProductColors.Any())
                    {
                        <div class="feature">
                            <span>🎨</span>
                            <div>
                                <strong>@Model.ProductColors.Count Colors</strong>
                                <p>Multiple color options</p>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Product Description & Details -->
        <div class="product-full-details">
            <!-- About Section -->
            <div class="detail-section" id="about">
                <h2>About @Model.Name</h2>
                <p class="lead">@Model.Name stands out with its lush, rose-shaped blooms in a rich, sweet fragrance that fills any space. It offers calm and elegant impact for premium floral arrangements.</p>

                <div class="perfect-for">
                    <h3>🎯 Perfect For</h3>
                    <div class="occasion-tags">
                        <span class="occasion-tag">Birthday</span>
                        <span class="occasion-tag">Thank You</span>
                        <span class="occasion-tag">Weddings</span>
                        <span class="occasion-tag">Romantic Occasions</span>
                        <span class="occasion-tag">Anniversary</span>
                        <span class="occasion-tag">Special Events</span>
                    </div>
                </div>
            </div>

            <!-- Care Guide -->
            <div class="tab-content" id="care">
                <h2>@Model.Name Care Guide</h2>
                <div class="care-guide-container">
                    <!-- Care info -->
                    <div class="care-steps-simple">
                        <div class="care-step">
                            <strong>Keep in cool environment</strong> - Away from direct sunlight and heat sources
                        </div>
                        <div class="care-step">
                            <strong>Water maintenance</strong> - Change water every 2 days and trim stems at an angle
                        </div>
                        <div class="care-step">
                            <strong>Leaf care</strong> - Remove any leaves that fall below the water line
                        </div>
                        <div class="care-step">
                            <strong>Vase preparation</strong> - Display in a clean vase with fresh flower food
                        </div>
                        <div class="care-step">
                            <strong>Avoid contamination</strong> - Keep away from ripening fruit or direct heat
                        </div>
                    </div>
                </div>
            </div>

            <!-- Related Products -->
            @if (relatedProducts != null && relatedProducts.Any())
            {
                <div class="detail-section">
                    <h2>Related Products</h2>
                    <div class="related-products-grid">
                        @foreach (var relatedProduct in relatedProducts)
                        {
                            <div class="related-product-card">
                                <a href="@Url.Action("Details", new { id = relatedProduct.ProductId })">
                                    <img src="@relatedProduct.MainImageUrl" alt="@relatedProduct.Name">
                                    <h4>@relatedProduct.Name</h4>
                                    <p>$@relatedProduct.BasePrice</p>
                                </a>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
    </div>
</section>

@section Scripts {
    <script>
    $(document).ready(function() {
        // Color selection
        $('.color-option-detail').click(function() {
            $('.color-option-detail').removeClass('active');
            $(this).addClass('active');

            var price = $(this).data('price');
            var colorName = $(this).data('color-name');
            var image = $(this).data('image');

            // Update price
            $('.current-price').text('$' + price);
            $('.add-to-cart-btn.large').text('Add to Cart - $' + price);

            // Update image
            if (image) {
                $('#mainProductImage').attr('src', image);
            }
        });

        // Quantity selector
        $('.quantity-btn.minus').click(function() {
            var $input = $(this).siblings('.quantity-input');
            var value = parseInt($input.val());
            if (value > 1) {
                $input.val(value - 1);
            }
        });

        $('.quantity-btn.plus').click(function() {
            var $input = $(this).siblings('.quantity-input');
            var value = parseInt($input.val());
            var max = parseInt($input.attr('max'));
            if (value < max) {
                $input.val(value + 1);
            }
        });

        // Add to cart
        $('.add-to-cart-btn.large').click(function() {
            var productId = $(this).data('product-id');
            var quantity = $('.quantity-input').val();
            var selectedColor = $('.color-option-detail.active').data('color-id') || null;

            // Add to cart logic here
            console.log('Adding to cart:', {
                productId: productId,
                quantity: quantity,
                colorId: selectedColor
            });

            // Show success message
            alert('Added to cart successfully!');
        });

        // Thumbnail click
        $('.thumbnail').click(function() {
            var imageUrl = $(this).data('image');
            if (imageUrl) {
                $('#mainProductImage').attr('src', imageUrl);
                $('.thumbnail').removeClass('active');
                $(this).addClass('active');
            }
        });
    });
    </script>
}